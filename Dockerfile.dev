# Use the official Bun image as a base
FROM oven/bun:1.2

# Set the working directory
WORKDIR /app

# Copy dependency manifests and config files
COPY package.json bun.lock ./
COPY tsconfig.json ./
COPY vite.config.ts ./
COPY components.json ./

# Install dependencies -- this layer will be cached
RUN bun install

# Copy the rest of the source code
COPY frontend/ ./frontend/

# Copy entrypoint script
COPY docker/entrypoint-dev.sh /entrypoint-dev.sh
RUN chmod +x /entrypoint-dev.sh

# The command to run when the container starts
# Use entrypoint to ensure symlink is created
ENTRYPOINT ["/entrypoint-dev.sh"]
CMD ["bun", "run", "dev", "--host", "0.0.0.0"]